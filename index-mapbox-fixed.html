<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gothenburg Quality of Life Map - Fixed Boundaries</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: #0a0a0a;
        }

        #map {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 20px;
            font-weight: 700;
            color: #333;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-weight: 700;
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
            margin: 0 24px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 16px;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .control-button {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #666;
            font-size: 16px;
        }

        .control-button:hover {
            background: #f8f9fa;
            border-color: #667eea;
            color: #667eea;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.open {
            right: 0;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-title {
            margin: 0 0 8px 0;
            font-size: 24px;
            font-weight: 600;
        }

        .sidebar-subtitle {
            margin: 0;
            opacity: 0.9;
            font-size: 14px;
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            transition: background 0.2s ease;
        }

        .close-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .sidebar-content {
            padding: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .stat-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }

        .stat-title {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .stat-description {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .info-box {
            position: absolute;
            top: 80px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 300px;
        }

        .info-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .info-text {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="header">
        <div class="logo">
            <div class="logo-icon">G</div>
            Gothenburg QoL Map (Fixed Boundaries)
        </div>
        
        <div class="search-container">
            <div class="search-icon">üîç</div>
            <input type="text" class="search-input" placeholder="Search areas..." id="searchInput">
        </div>
        
        <div class="controls">
            <button class="control-button" title="Layer Controls">üìä</button>
            <button class="control-button" title="Filter Data">üîß</button>
            <button class="control-button" title="Export Data">üì•</button>
            <button class="control-button" title="Menu">‚ò∞</button>
        </div>
    </div>

    <div class="info-box">
        <div class="info-title">Fixed District Boundaries</div>
        <div class="info-text">
            Using properly spaced coordinates to prevent overlapping districts.
        </div>
    </div>

    <div class="legend">
        <h4 style="margin: 0 0 12px 0; font-size: 14px; font-weight: 600;">Crime Level Legend</h4>
        <div class="legend-item">
            <div class="color-box" style="background: #4ade80;"></div>
            <span>Low (0-25)</span>
        </div>
        <div class="legend-item">
            <div class="color-box" style="background: #22c55e;"></div>
            <span>Medium (26-50)</span>
        </div>
        <div class="legend-item">
            <div class="color-box" style="background: #eab308;"></div>
            <span>High (51-75)</span>
        </div>
        <div class="legend-item">
            <div class="color-box" style="background: #ef4444;"></div>
            <span>Very High (76-100)</span>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title" id="sidebarTitle">Area Details</h2>
            <p class="sidebar-subtitle">Fixed District Statistics & Analysis</p>
            <button class="close-button" onclick="closeSidebar()">√ó</button>
        </div>
        <div class="sidebar-content" id="sidebarContent">
            <!-- Content will be populated by JavaScript -->
        </div>
    </div>

    <div class="loading" id="loading">
        <div>Loading district boundaries...</div>
    </div>

    <script>
        // Gothenburg district data with properly spaced coordinates
        const areaData = [
            {
                id: 'centrum',
                name: 'Centrum',
                crimeLevel: 45,
                tertiaryEducation: 78,
                medianIncome: 420000,
                population: 45000,
                area: 2.1,
                center: [11.9746, 57.7089],
                size: 0.008
            },
            {
                id: 'haga',
                name: 'Haga',
                crimeLevel: 35,
                tertiaryEducation: 82,
                medianIncome: 380000,
                population: 12000,
                area: 0.8,
                center: [11.9726, 57.7069],
                size: 0.005
            },
            {
                id: 'linn√©gatan',
                name: 'Linn√©gatan',
                crimeLevel: 25,
                tertiaryEducation: 85,
                medianIncome: 450000,
                population: 18000,
                area: 1.2,
                center: [11.9766, 57.7109],
                size: 0.006
            },
            {
                id: 'vasastan',
                name: 'Vasastan',
                crimeLevel: 30,
                tertiaryEducation: 80,
                medianIncome: 410000,
                population: 25000,
                area: 1.8,
                center: [11.9786, 57.7129],
                size: 0.007
            },
            {
                id: 'olskroken',
                name: 'Olskroken',
                crimeLevel: 55,
                tertiaryEducation: 65,
                medianIncome: 320000,
                population: 22000,
                area: 1.5,
                center: [11.9846, 57.7089],
                size: 0.006
            },
            {
                id: 'angered',
                name: 'Angered',
                crimeLevel: 75,
                tertiaryEducation: 45,
                medianIncome: 280000,
                population: 35000,
                area: 3.2,
                center: [11.9946, 57.7209],
                size: 0.012
            },
            {
                id: 'bergsj√∂n',
                name: 'Bergsj√∂n',
                crimeLevel: 70,
                tertiaryEducation: 50,
                medianIncome: 290000,
                population: 28000,
                area: 2.8,
                center: [11.9926, 57.7189],
                size: 0.010
            },
            {
                id: 'kortedala',
                name: 'Kortedala',
                crimeLevel: 60,
                tertiaryEducation: 55,
                medianIncome: 310000,
                population: 32000,
                area: 2.5,
                center: [11.9806, 57.7169],
                size: 0.009
            },
            {
                id: 'torslanda',
                name: 'Torslanda',
                crimeLevel: 40,
                tertiaryEducation: 70,
                medianIncome: 360000,
                population: 15000,
                area: 4.1,
                center: [11.9586, 57.7249],
                size: 0.015
            },
            {
                id: 'm√∂lndal',
                name: 'M√∂lndal',
                crimeLevel: 35,
                tertiaryEducation: 75,
                medianIncome: 390000,
                population: 42000,
                area: 5.2,
                center: [11.9906, 57.6969],
                size: 0.020
            }
        ];

        // Gothenburg coordinates
        const GOTHENBURG_CENTER = [11.9746, 57.7089];

        // Initialize map with your Mapbox token
        mapboxgl.accessToken = 'pk.eyJ1IjoiampnZXJtaXMiLCJhIjoiY21keGdwN2x6MWl2dTJtcXlxNnA5Nm95diJ9.YHpPz4HkXBihGl7FuPYbLQ';
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v11',
            center: GOTHENBURG_CENTER,
            zoom: 11,
            attributionControl: false
        });

        let selectedArea = null;

        // Function to create district boundaries with proper spacing
        function createDistrictBoundaries() {
            const features = [];
            
            for (const area of areaData) {
                const [lng, lat] = area.center;
                const size = area.size;
                
                // Create boundary based on district characteristics
                let boundary;
                
                switch (area.name.toLowerCase()) {
                    case 'centrum':
                        // Centrum - downtown area
                        boundary = [
                            [lng - size * 0.8, lat - size * 0.6],
                            [lng + size * 0.9, lat - size * 0.7],
                            [lng + size * 1.1, lat + size * 0.3],
                            [lng + size * 0.4, lat + size * 0.8],
                            [lng - size * 0.5, lat + size * 0.9],
                            [lng - size * 0.8, lat + size * 0.2],
                            [lng - size * 0.8, lat - size * 0.6]
                        ];
                        break;
                        
                    case 'haga':
                        // Haga - historic district
                        boundary = [
                            [lng - size * 0.6, lat - size * 0.5],
                            [lng + size * 0.7, lat - size * 0.6],
                            [lng + size * 0.8, lat + size * 0.4],
                            [lng + size * 0.3, lat + size * 0.7],
                            [lng - size * 0.4, lat + size * 0.8],
                            [lng - size * 0.7, lat + size * 0.3],
                            [lng - size * 0.6, lat - size * 0.5]
                        ];
                        break;
                        
                    case 'linn√©gatan':
                        // Linn√©gatan - upscale area
                        boundary = [
                            [lng - size * 0.7, lat - size * 0.5],
                            [lng + size * 0.8, lat - size * 0.6],
                            [lng + size * 0.9, lat + size * 0.4],
                            [lng + size * 0.4, lat + size * 0.7],
                            [lng - size * 0.5, lat + size * 0.8],
                            [lng - size * 0.8, lat + size * 0.3],
                            [lng - size * 0.7, lat - size * 0.5]
                        ];
                        break;
                        
                    case 'vasastan':
                        // Vasastan - residential area
                        boundary = [
                            [lng - size * 0.8, lat - size * 0.6],
                            [lng + size * 0.9, lat - size * 0.7],
                            [lng + size * 1.0, lat + size * 0.4],
                            [lng + size * 0.5, lat + size * 0.7],
                            [lng - size * 0.6, lat + size * 0.8],
                            [lng - size * 0.9, lat + size * 0.3],
                            [lng - size * 0.8, lat - size * 0.6]
                        ];
                        break;
                        
                    case 'olskroken':
                        // Olskroken - east of centrum
                        boundary = [
                            [lng - size * 0.7, lat - size * 0.5],
                            [lng + size * 0.8, lat - size * 0.6],
                            [lng + size * 0.9, lat + size * 0.4],
                            [lng + size * 0.4, lat + size * 0.7],
                            [lng - size * 0.5, lat + size * 0.8],
                            [lng - size * 0.8, lat + size * 0.3],
                            [lng - size * 0.7, lat - size * 0.5]
                        ];
                        break;
                        
                    case 'angered':
                        // Angered - northeastern suburb
                        boundary = [
                            [lng - size * 0.9, lat - size * 0.7],
                            [lng + size * 1.0, lat - size * 0.8],
                            [lng + size * 1.1, lat + size * 0.5],
                            [lng + size * 0.6, lat + size * 0.8],
                            [lng - size * 0.7, lat + size * 0.9],
                            [lng - size * 1.0, lat + size * 0.4],
                            [lng - size * 0.9, lat - size * 0.7]
                        ];
                        break;
                        
                    case 'bergsj√∂n':
                        // Bergsj√∂n - between Angered and centrum
                        boundary = [
                            [lng - size * 0.8, lat - size * 0.6],
                            [lng + size * 0.9, lat - size * 0.7],
                            [lng + size * 1.0, lat + size * 0.4],
                            [lng + size * 0.5, lat + size * 0.7],
                            [lng - size * 0.6, lat + size * 0.8],
                            [lng - size * 0.9, lat + size * 0.3],
                            [lng - size * 0.8, lat - size * 0.6]
                        ];
                        break;
                        
                    case 'kortedala':
                        // Kortedala - northwestern suburb
                        boundary = [
                            [lng - size * 0.8, lat - size * 0.6],
                            [lng + size * 0.9, lat - size * 0.7],
                            [lng + size * 1.0, lat + size * 0.4],
                            [lng + size * 0.5, lat + size * 0.7],
                            [lng - size * 0.6, lat + size * 0.8],
                            [lng - size * 0.9, lat + size * 0.3],
                            [lng - size * 0.8, lat - size * 0.6]
                        ];
                        break;
                        
                    case 'torslanda':
                        // Torslanda - western coastal area
                        boundary = [
                            [lng - size * 1.0, lat - size * 0.8],
                            [lng + size * 1.1, lat - size * 0.9],
                            [lng + size * 1.2, lat + size * 0.6],
                            [lng + size * 0.7, lat + size * 0.9],
                            [lng - size * 0.8, lat + size * 1.0],
                            [lng - size * 1.1, lat + size * 0.5],
                            [lng - size * 1.0, lat - size * 0.8]
                        ];
                        break;
                        
                    case 'm√∂lndal':
                        // M√∂lndal - southern municipality
                        boundary = [
                            [lng - size * 1.1, lat - size * 0.9],
                            [lng + size * 1.2, lat - size * 1.0],
                            [lng + size * 1.3, lat + size * 0.7],
                            [lng + size * 0.8, lat + size * 1.0],
                            [lng - size * 0.9, lat + size * 1.1],
                            [lng - size * 1.2, lat + size * 0.6],
                            [lng - size * 1.1, lat - size * 0.9]
                        ];
                        break;
                        
                    default:
                        // Default rectangular boundary
                        boundary = [
                            [lng - size, lat - size],
                            [lng + size, lat - size],
                            [lng + size, lat + size],
                            [lng - size, lat + size],
                            [lng - size, lat - size]
                        ];
                }
                
                features.push({
                    type: 'Feature',
                    geometry: {
                        type: 'Polygon',
                        coordinates: [boundary]
                    },
                    properties: {
                        id: area.id,
                        name: area.name,
                        crimeLevel: area.crimeLevel,
                        tertiaryEducation: area.tertiaryEducation,
                        medianIncome: area.medianIncome,
                        population: area.population,
                        area: area.area,
                        center: area.center
                    }
                });
            }
            
            return features;
        }

        map.on('load', () => {
            // Show loading indicator
            document.getElementById('loading').style.display = 'block';
            
            try {
                // Create district boundaries with proper spacing
                const features = createDistrictBoundaries();
                
                // Add custom source for areas
                map.addSource('areas', {
                    type: 'geojson',
                    data: {
                        type: 'FeatureCollection',
                        features: features
                    }
                });

                // Add fill layer for crime levels with improved styling
                map.addLayer({
                    id: 'areas-fill',
                    type: 'fill',
                    source: 'areas',
                    paint: {
                        'fill-color': [
                            'interpolate',
                            ['linear'],
                            ['get', 'crimeLevel'],
                            0, '#4ade80',   // Green for low crime
                            25, '#22c55e',
                            50, '#eab308',  // Yellow for medium crime
                            75, '#f97316',  // Orange for high crime
                            100, '#ef4444'  // Red for very high crime
                        ],
                        'fill-opacity': 0.8,
                        'fill-outline-color': '#ffffff'
                    }
                });

                // Add outline layer with improved styling
                map.addLayer({
                    id: 'areas-outline',
                    type: 'line',
                    source: 'areas',
                    paint: {
                        'line-color': '#ffffff',
                        'line-width': 2,
                        'line-opacity': 0.9
                    }
                });

                // Add shadow layer for levitating effect
                map.addLayer({
                    id: 'areas-shadow',
                    type: 'fill',
                    source: 'areas',
                    paint: {
                        'fill-color': '#000000',
                        'fill-opacity': 0
                    },
                    filter: ['==', ['get', 'id'], 'none']
                });

                // Enhanced hover effects with levitation
                map.on('mouseenter', 'areas-fill', () => {
                    map.getCanvas().style.cursor = 'pointer';
                    
                    // Increase opacity and add shadow for levitating effect
                    map.setPaintProperty('areas-fill', 'fill-opacity', 0.95);
                    map.setPaintProperty('areas-outline', 'line-width', 3);
                    map.setPaintProperty('areas-outline', 'line-opacity', 1);
                    
                    // Add shadow effect
                    const hoveredFeature = map.queryRenderedFeatures({ layers: ['areas-fill'] })[0];
                    if (hoveredFeature) {
                        map.setFilter('areas-shadow', ['==', ['get', 'id'], hoveredFeature.properties.id]);
                        map.setPaintProperty('areas-shadow', 'fill-opacity', 0.3);
                    }
                });

                map.on('mouseleave', 'areas-fill', () => {
                    map.getCanvas().style.cursor = '';
                    
                    // Reset to normal state
                    map.setPaintProperty('areas-fill', 'fill-opacity', 0.8);
                    map.setPaintProperty('areas-outline', 'line-width', 2);
                    map.setPaintProperty('areas-outline', 'line-opacity', 0.9);
                    
                    // Remove shadow effect
                    map.setFilter('areas-shadow', ['==', ['get', 'id'], 'none']);
                    map.setPaintProperty('areas-shadow', 'fill-opacity', 0);
                });

                // Add click handler
                map.on('click', 'areas-fill', (e) => {
                    if (e.features && e.features[0]) {
                        const feature = e.features[0];
                        const area = areaData.find(a => a.id === feature.properties.id);
                        if (area) {
                            showAreaDetails(area);
                        }
                    }
                });
                
                // Hide loading indicator
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('Error loading district boundaries:', error);
                document.getElementById('loading').style.display = 'none';
            }
        });

        function getCrimeLevelColor(level) {
            if (level <= 25) return '#4ade80';
            if (level <= 50) return '#22c55e';
            if (level <= 75) return '#eab308';
            return '#ef4444';
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('sv-SE').format(num);
        }

        function showAreaDetails(area) {
            selectedArea = area;
            document.getElementById('sidebarTitle').textContent = area.name;
            
            const content = `
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: ${getCrimeLevelColor(area.crimeLevel)}">üõ°Ô∏è</div>
                        <h3 class="stat-title">Crime Level</h3>
                    </div>
                    <div class="stat-value" style="color: ${getCrimeLevelColor(area.crimeLevel)}">${area.crimeLevel}/100</div>
                    <p class="stat-description">Crime level based on reported incidents per capita</p>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #8b5cf6">üéì</div>
                        <h3 class="stat-title">Education</h3>
                    </div>
                    <div class="stat-value">${area.tertiaryEducation}%</div>
                    <p class="stat-description">Percentage of population with tertiary education</p>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #10b981">üí∞</div>
                        <h3 class="stat-title">Median Income</h3>
                    </div>
                    <div class="stat-value">${formatNumber(area.medianIncome)} SEK</div>
                    <p class="stat-description">Annual median household income</p>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #f59e0b">üë•</div>
                        <h3 class="stat-title">Population</h3>
                    </div>
                    <div class="stat-value">${formatNumber(area.population)}</div>
                    <p class="stat-description">Total population in the area</p>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #06b6d4">üìà</div>
                        <h3 class="stat-title">Quality of Life Index</h3>
                    </div>
                    <div class="stat-value">${Math.round(
                        (100 - area.crimeLevel) * 0.4 +
                        area.tertiaryEducation * 0.3 +
                        (area.medianIncome / 500000) * 100 * 0.3
                    )}</div>
                    <p class="stat-description">Composite score based on crime, education, and income</p>
                </div>
            `;
            
            document.getElementById('sidebarContent').innerHTML = content;
            document.getElementById('sidebar').classList.add('open');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open');
            selectedArea = null;
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredAreas = areaData.filter(area => 
                area.name.toLowerCase().includes(searchTerm)
            );
            
            if (filteredAreas.length > 0 && searchTerm.length > 0) {
                showAreaDetails(filteredAreas[0]);
            }
        });
    </script>
</body>
</html> 