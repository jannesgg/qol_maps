<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gothenburg Quality of Life Map - Dots</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: #0a0a0a;
        }

        #map {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 20px;
            font-weight: 700;
            color: #333;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-weight: 700;
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
            margin: 0 24px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 16px;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .control-button {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #666;
            font-size: 16px;
        }

        .control-button:hover {
            background: #f8f9fa;
            border-color: #667eea;
            color: #667eea;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.open {
            right: 0;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-title {
            margin: 0 0 8px 0;
            font-size: 24px;
            font-weight: 600;
        }

        .sidebar-subtitle {
            margin: 0;
            opacity: 0.9;
            font-size: 14px;
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            transition: background 0.2s ease;
        }

        .close-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .sidebar-content {
            padding: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .stat-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }

        .stat-title {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .stat-description {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .info-box {
            position: absolute;
            top: 80px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 300px;
        }

        .info-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .info-text {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="header">
        <div class="logo">
            <div class="logo-icon">G</div>
            Gothenburg QoL Map (Dots)
        </div>
        
        <div class="search-container">
            <div class="search-icon">üîç</div>
            <input type="text" class="search-input" placeholder="Search areas..." id="searchInput">
        </div>
        
        <div class="controls">
            <button class="control-button" title="Layer Controls">üìä</button>
            <button class="control-button" title="Filter Data">üîß</button>
            <button class="control-button" title="Export Data">üì•</button>
            <button class="control-button" title="Menu">‚ò∞</button>
        </div>
    </div>

    <div class="info-box">
        <div class="info-title">District Dots</div>
        <div class="info-text">
            Using Mapbox geocoding to get accurate coordinates for each district.
        </div>
    </div>

    <div class="legend">
        <h4 style="margin: 0 0 12px 0; font-size: 14px; font-weight: 600;">Crime Level Legend</h4>
        <div class="legend-item">
            <div class="color-box" style="background: #4ade80;"></div>
            <span>Low (0-25)</span>
        </div>
        <div class="legend-item">
            <div class="color-box" style="background: #22c55e;"></div>
            <span>Medium (26-50)</span>
        </div>
        <div class="legend-item">
            <div class="color-box" style="background: #eab308;"></div>
            <span>High (51-75)</span>
        </div>
        <div class="legend-item">
            <div class="color-box" style="background: #ef4444;"></div>
            <span>Very High (76-100)</span>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title" id="sidebarTitle">Area Details</h2>
            <p class="sidebar-subtitle">District Statistics & Analysis</p>
            <button class="close-button" onclick="closeSidebar()">√ó</button>
        </div>
        <div class="sidebar-content" id="sidebarContent">
            <!-- Content will be populated by JavaScript -->
        </div>
    </div>

    <div class="loading" id="loading">
        <div>Loading district locations...</div>
    </div>

    <script>
        // Gothenburg district data with search queries
        const areaData = [
            {
                id: 'centrum',
                name: 'Centrum',
                crimeLevel: 45,
                tertiaryEducation: 78,
                medianIncome: 420000,
                population: 45000,
                area: 2.1,
                searchQuery: 'Centrum, G√∂teborg, Sweden'
            },
            {
                id: 'haga',
                name: 'Haga',
                crimeLevel: 35,
                tertiaryEducation: 82,
                medianIncome: 380000,
                population: 12000,
                area: 0.8,
                searchQuery: 'Haga, G√∂teborg, Sweden'
            },
            {
                id: 'linn√©gatan',
                name: 'Linn√©gatan',
                crimeLevel: 25,
                tertiaryEducation: 85,
                medianIncome: 450000,
                population: 18000,
                area: 1.2,
                searchQuery: 'Linn√©gatan, G√∂teborg, Sweden'
            },
            {
                id: 'vasastan',
                name: 'Vasastan',
                crimeLevel: 30,
                tertiaryEducation: 80,
                medianIncome: 410000,
                population: 25000,
                area: 1.8,
                searchQuery: 'Vasastan, G√∂teborg, Sweden'
            },
            {
                id: 'olskroken',
                name: 'Olskroken',
                crimeLevel: 55,
                tertiaryEducation: 65,
                medianIncome: 320000,
                population: 22000,
                area: 1.5,
                searchQuery: 'Olskroken, G√∂teborg, Sweden'
            },
            {
                id: 'angered',
                name: 'Angered',
                crimeLevel: 75,
                tertiaryEducation: 45,
                medianIncome: 280000,
                population: 35000,
                area: 3.2,
                searchQuery: 'Angered, G√∂teborg, Sweden'
            },
            {
                id: 'bergsj√∂n',
                name: 'Bergsj√∂n',
                crimeLevel: 70,
                tertiaryEducation: 50,
                medianIncome: 290000,
                population: 28000,
                area: 2.8,
                searchQuery: 'Bergsj√∂n, G√∂teborg, Sweden'
            },
            {
                id: 'kortedala',
                name: 'Kortedala',
                crimeLevel: 60,
                tertiaryEducation: 55,
                medianIncome: 310000,
                population: 32000,
                area: 2.5,
                searchQuery: 'Kortedala, G√∂teborg, Sweden'
            },
            {
                id: 'torslanda',
                name: 'Torslanda',
                crimeLevel: 40,
                tertiaryEducation: 70,
                medianIncome: 360000,
                population: 15000,
                area: 4.1,
                searchQuery: 'Torslanda, G√∂teborg, Sweden'
            },
            {
                id: 'm√∂lndal',
                name: 'M√∂lndal',
                crimeLevel: 35,
                tertiaryEducation: 75,
                medianIncome: 390000,
                population: 42000,
                area: 5.2,
                searchQuery: 'M√∂lndal, Sweden'
            }
        ];

        // Gothenburg coordinates
        const GOTHENBURG_CENTER = [11.9746, 57.7089];

        // Initialize map with your Mapbox token
        mapboxgl.accessToken = 'pk.eyJ1IjoiampnZXJtaXMiLCJhIjoiY21keGdwN2x6MWl2dTJtcXlxNnA5Nm95diJ9.YHpPz4HkXBihGl7FuPYbLQ';
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v11',
            center: GOTHENBURG_CENTER,
            zoom: 11,
            attributionControl: false
        });

        let selectedArea = null;

        // Function to geocode a location using Mapbox API
        async function geocodeLocation(searchQuery) {
            try {
                const response = await fetch(
                    `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(searchQuery)}.json?access_token=${mapboxgl.accessToken}&country=SE&types=place,neighborhood`
                );
                const data = await response.json();
                
                if (data.features && data.features.length > 0) {
                    const [lng, lat] = data.features[0].center;
                    console.log(`${searchQuery}: [${lng}, ${lat}]`);
                    return [lng, lat];
                } else {
                    console.warn(`No results found for: ${searchQuery}`);
                    return null;
                }
            } catch (error) {
                console.error(`Error geocoding ${searchQuery}:`, error);
                return null;
            }
        }

        // Function to create dots from geocoded data
        async function createDistrictDots() {
            const features = [];
            
            for (const area of areaData) {
                const coordinates = await geocodeLocation(area.searchQuery);
                
                if (coordinates) {
                    features.push({
                        type: 'Feature',
                        geometry: {
                            type: 'Point',
                            coordinates: coordinates
                        },
                        properties: {
                            id: area.id,
                            name: area.name,
                            crimeLevel: area.crimeLevel,
                            tertiaryEducation: area.tertiaryEducation,
                            medianIncome: area.medianIncome,
                            population: area.population,
                            area: area.area,
                            center: coordinates
                        }
                    });
                }
            }
            
            return features;
        }

        map.on('load', async () => {
            // Show loading indicator
            document.getElementById('loading').style.display = 'block';
            
            try {
                // Create district dots from geocoded data
                const features = await createDistrictDots();
                
                // Add custom source for areas
                map.addSource('areas', {
                    type: 'geojson',
                    data: {
                        type: 'FeatureCollection',
                        features: features
                    }
                });

                // Add circle layer for crime levels
                map.addLayer({
                    id: 'areas-circles',
                    type: 'circle',
                    source: 'areas',
                    paint: {
                        'circle-color': [
                            'interpolate',
                            ['linear'],
                            ['get', 'crimeLevel'],
                            0, '#4ade80',   // Green for low crime
                            25, '#22c55e',
                            50, '#eab308',  // Yellow for medium crime
                            75, '#f97316',  // Orange for high crime
                            100, '#ef4444'  // Red for very high crime
                        ],
                        'circle-radius': [
                            'interpolate',
                            ['linear'],
                            ['get', 'population'],
                            0, 8,
                            10000, 12,
                            20000, 16,
                            30000, 20,
                            50000, 24
                        ],
                        'circle-opacity': 0.8,
                        'circle-stroke-color': '#ffffff',
                        'circle-stroke-width': 2
                    }
                });

                // Enhanced hover effects
                map.on('mouseenter', 'areas-circles', () => {
                    map.getCanvas().style.cursor = 'pointer';
                    
                    // Increase size and opacity for hover effect
                    map.setPaintProperty('areas-circles', 'circle-radius', [
                        'interpolate',
                        ['linear'],
                        ['get', 'population'],
                        0, 12,
                        10000, 18,
                        20000, 24,
                        30000, 28,
                        50000, 32
                    ]);
                    map.setPaintProperty('areas-circles', 'circle-opacity', 0.95);
                    map.setPaintProperty('areas-circles', 'circle-stroke-width', 3);
                });

                map.on('mouseleave', 'areas-circles', () => {
                    map.getCanvas().style.cursor = '';
                    
                    // Reset to normal state
                    map.setPaintProperty('areas-circles', 'circle-radius', [
                        'interpolate',
                        ['linear'],
                        ['get', 'population'],
                        0, 8,
                        10000, 12,
                        20000, 16,
                        30000, 20,
                        50000, 24
                    ]);
                    map.setPaintProperty('areas-circles', 'circle-opacity', 0.8);
                    map.setPaintProperty('areas-circles', 'circle-stroke-width', 2);
                });

                // Add click handler
                map.on('click', 'areas-circles', (e) => {
                    if (e.features && e.features[0]) {
                        const feature = e.features[0];
                        const area = areaData.find(a => a.id === feature.properties.id);
                        if (area) {
                            showAreaDetails(area);
                        }
                    }
                });
                
                // Hide loading indicator
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('Error loading district dots:', error);
                document.getElementById('loading').style.display = 'none';
            }
        });

        function getCrimeLevelColor(level) {
            if (level <= 25) return '#4ade80';
            if (level <= 50) return '#22c55e';
            if (level <= 75) return '#eab308';
            return '#ef4444';
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('sv-SE').format(num);
        }

        function showAreaDetails(area) {
            selectedArea = area;
            document.getElementById('sidebarTitle').textContent = area.name;
            
            const content = `
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: ${getCrimeLevelColor(area.crimeLevel)}">üõ°Ô∏è</div>
                        <h3 class="stat-title">Crime Level</h3>
                    </div>
                    <div class="stat-value" style="color: ${getCrimeLevelColor(area.crimeLevel)}">${area.crimeLevel}/100</div>
                    <p class="stat-description">Crime level based on reported incidents per capita</p>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #8b5cf6">üéì</div>
                        <h3 class="stat-title">Education</h3>
                    </div>
                    <div class="stat-value">${area.tertiaryEducation}%</div>
                    <p class="stat-description">Percentage of population with tertiary education</p>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #10b981">üí∞</div>
                        <h3 class="stat-title">Median Income</h3>
                    </div>
                    <div class="stat-value">${formatNumber(area.medianIncome)} SEK</div>
                    <p class="stat-description">Annual median household income</p>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #f59e0b">üë•</div>
                        <h3 class="stat-title">Population</h3>
                    </div>
                    <div class="stat-value">${formatNumber(area.population)}</div>
                    <p class="stat-description">Total population in the area</p>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #06b6d4">üìà</div>
                        <h3 class="stat-title">Quality of Life Index</h3>
                    </div>
                    <div class="stat-value">${Math.round(
                        (100 - area.crimeLevel) * 0.4 +
                        area.tertiaryEducation * 0.3 +
                        (area.medianIncome / 500000) * 100 * 0.3
                    )}</div>
                    <p class="stat-description">Composite score based on crime, education, and income</p>
                </div>
            `;
            
            document.getElementById('sidebarContent').innerHTML = content;
            document.getElementById('sidebar').classList.add('open');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open');
            selectedArea = null;
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredAreas = areaData.filter(area => 
                area.name.toLowerCase().includes(searchTerm)
            );
            
            if (filteredAreas.length > 0 && searchTerm.length > 0) {
                showAreaDetails(filteredAreas[0]);
            }
        });
    </script>
</body>
</html> 